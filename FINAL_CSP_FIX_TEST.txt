// ğŸ”’ FINAL CSP COMPLIANCE TEST
// Paste this in browser console to verify CSP violations are resolved

console.log('ğŸ”’ TESTING FINAL CSP COMPLIANCE...');
console.log('===============================');

// Check for any remaining CSP violations
const cspViolations = [];
let violationCount = 0;

// Listen for CSP violations
document.addEventListener('securitypolicyviolation', (e) => {
    violationCount++;
    cspViolations.push({
        directive: e.violatedDirective,
        blockedURI: e.blockedURI,
        source: e.sourceFile + ':' + e.lineNumber
    });
    console.log(`âŒ CSP Violation #${violationCount}:`, {
        directive: e.violatedDirective,
        blocked: e.blockedURI,
        source: e.sourceFile + ':' + e.lineNumber
    });
});

// Wait 5 seconds then report results
setTimeout(() => {
    console.log('\nğŸ”’ CSP COMPLIANCE REPORT:');
    console.log('========================');
    
    if (violationCount === 0) {
        console.log('âœ… PERFECT CSP COMPLIANCE!');
        console.log('ğŸ‰ No Content Security Policy violations detected');
        console.log('ğŸ”’ All resources loading from approved sources');
    } else {
        console.log(`âŒ ${violationCount} CSP violations detected:`);
        cspViolations.forEach((violation, index) => {
            console.log(`${index + 1}. ${violation.directive}: ${violation.blockedURI}`);
            console.log(`   Source: ${violation.source}`);
        });
    }
    
    // Check app functionality
    console.log('\nğŸ¯ APP FUNCTIONALITY CHECK:');
    console.log('===========================');
    
    const checks = {
        'Velvet Brain Active': typeof window.velvetBrain !== 'undefined' && window.velvetBrain?.isActive,
        'Social Decoder Available': typeof SocialDecoder !== 'undefined',
        'Executive Dysfunction Available': typeof window.electronAPI !== 'undefined',
        'Screen OCR Available': typeof Tesseract !== 'undefined',
        'Context Awareness Active': typeof ContextAwarenessSystem !== 'undefined'
    };
    
    Object.entries(checks).forEach(([name, status]) => {
        console.log(`${status ? 'âœ…' : 'âš ï¸'} ${name}: ${status ? 'Working' : 'Not Available'}`);
    });
    
    const functionalCount = Object.values(checks).filter(Boolean).length;
    const totalChecks = Object.keys(checks).length;
    
    console.log(`\nğŸ† FUNCTIONALITY SCORE: ${functionalCount}/${totalChecks} (${Math.round(functionalCount/totalChecks*100)}%)`);
    
    if (violationCount === 0 && functionalCount >= 4) {
        console.log('\nğŸ‰ PERFECT SUCCESS!');
        console.log('âœ… CSP Compliant + Core Features Working');
        console.log('ğŸš€ Velvet is ready for production!');
    } else if (violationCount === 0) {
        console.log('\nâœ… CSP COMPLIANCE ACHIEVED!');
        console.log('âš ï¸ Some features may need additional setup');
    } else {
        console.log('\nâš ï¸ CSP violations still present');
        console.log('ğŸ”§ Additional fixes needed');
    }
    
}, 5000);

console.log('â³ Monitoring for CSP violations for 5 seconds...');